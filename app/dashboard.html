<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf8">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="white">
        <meta name="apple-mobile-web-app-title" content="Aquino">
        <meta name="format-detection" content="telephone=no">
        <meta name="HandheldFriendly" content="true">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <title>Aquino</title>

        <link rel="stylesheet" type="text/css" href="static/css/app.css">
    </head>

    <body>

        <!-- Notifications container -->
        <section id="notifications-container"></section>

        <!-- Navigation sidebar -->
        <nav id="nav" class="transition">
            <span class="list">
                <h3 class="active change-page" data-page="dashboard/index">Accueil</h3>
                <h3 class="change-page" data-page="dashboard/live">Live</h3>
                <h3 class="change-page" data-page="dashboard/reglages">Configurations</h3>
                <h3 onclick="window.location.href = 'index.html';">Déconnexion</h3>

                <br>
                <button class="btn blue" id="to-feed">Nourrire les poissons maintenant</button>
            </span>
        </nav>

        <header id="header" class="transition">
            <!-- Boutons de navigation -->
            <button id="display-nav" class="btn icon nav left"><span class="ion-navicon"></span></button>
            <button id="back" class="btn icon nav left"><span class="ion-ios7-arrow-left"></span></button>
            <button id="display-notif" class="btn icon notif right got-badge change-page" data-page="dashboard/notifs">
                <span class="badge" id="alerts-count"></span>
                <span class="ion-ios7-bell-outline"></span>
            </button>
            <button id="hide-notif" class="btn icon notif right">
                <span class="ion-ios7-close-outline"></span>
            </button>

            <!-- Logo & etat -->
            <a id="logo">
                <img id="aquarium-state" data-type="on" src="static/images/thumb/on.png" width="50">
            </a>
        </header>

        <!-- Contenue -->
        <section id="content" class="transition logged-content"></section>

        <script type="text/javascript" src="scripts/lib/jquery.js"></script>
        <script type="text/javascript" src="scripts/lib/fastclick.js"></script>
        <script type="text/javascript" src="scripts/lib/mustache.js"></script>
        <script type="text/javascript" src="scripts/app.js"></script>
        <script type="text/javascript" src="scripts/controllers/apiCtrl.js"></script>
        <script type="text/javascript" src="scripts/controllers/notificationCtrl.js"></script>

        <script>
            checkNotifs();
            setInterval(checkNotifs, 60000);

            function checkNotifs ()
            {
                apiCtrl.request('/alerts/count', [], function (datas) {
                    if (datas.error) {
                        return false;
                    }

                    if (datas.count > 0) {
                        $('#alerts-count').html(datas.count);
                    }
                });
            }

            // Verification logo state
            setInterval(function() {
                var count = parseInt($('#alerts-count').html());
                var state = $('#aquarium-state');
                var type = state.attr('data-type');

                if (count > 0) {
                    if (type == 'on') {
                        $('#aquarium-state').attr('src', 'static/images/thumb/off.png');
                        $('#aquarium-state').attr('data-type', 'off');
                    }
                } else {
                    if (type == 'off') {
                        $('#aquarium-state').attr('src', 'static/images/thumb/on.png');
                        $('#aquarium-state').attr('data-type', 'on');
                    }
                }
            }, 1000);
        </script>

        <!-- TEMPLATES -->
        <script type="text/template" id="template-error">
            <div class="error">
                <h3>Une erreur est survenue !</h3>
                <p>
                    Merci de ré-essayer plus tard
                </p>
            </div>
        </script>
    </body>
</html>